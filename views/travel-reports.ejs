<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/images/favicon.ico">
    <title>Doowon Portal - 출장보고관리</title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/darkmode.css" />
</head>

<body>
    <header class="header">
        <div class="logo"><a href="http://211.238.111.33:8080/cb/"><img src="images/doowon_logo.png" alt="Logo" /></a></div>
        <div class="title-container"><h1>Doowon Portal</h1><p>두원공조 포탈</p></div>
        <div class="menu-container">
            <span class="menu-item"><img src="images/user.svg" alt="User" /><%= username %></span>
            <a href="#" class="menu-item" onclick="handleLogout()"><img src="images/logout.svg" alt="Logout" />Logout</a>
        </div>                  
    </header>

    <nav class="main-nav">
        <div class="nav-container">
            <a href="/" class="nav-item <%= currentPath === '/' ? 'active' : '' %>">
                <img src="images/home.svg" alt="Home" />
                <span>대시보드</span>
            </a>
            <a href="/weekly-reports" class="nav-item <%= currentPath === '/weekly-reports' ? 'active' : '' %>">
                <img src="images/settings.svg" alt="Weekly Reports" />
                <span>주간보고관리</span>
            </a>
            <a href="/travel-reports" class="nav-item <%= currentPath === '/travel-reports' ? 'active' : '' %>">
                <img src="images/settings.svg" alt="Travel Reports" />
                <span>출장보고관리</span>
            </a>
            <a href="/hardware-management" class="nav-item <%= currentPath === '/hardware-management' ? 'active' : '' %>">
                <img src="images/settings.svg" alt="Hardware Management" />
                <span>하드웨어관리</span>
            </a>
            <a href="/equipment-management" class="nav-item <%= currentPath === '/equipment-management' ? 'active' : '' %>">
                <img src="images/settings.svg" alt="Equipment Management" />
                <span>장비관리</span>
            </a>
            <a href="/external-training" class="nav-item <%= currentPath === '/external-training' ? 'active' : '' %>">
                <img src="images/settings.svg" alt="External Training" />
                <span>외부교육관리</span>
            </a>
        </div>
    </nav>

    <div class="main-container">
        <div class="page-header">
            <h2>✈️ 출장보고관리</h2>
            <p>출장 보고서를 작성, 제출 및 관리할 수 있습니다.</p>
        </div>

        <div class="content-section">
            <div class="section-header">
                <h3>새 출장보고 작성</h3>
                <button class="btn-primary" onclick="showCreateForm()">+ 새 출장보고 작성</button>
            </div>

            <div class="create-form" id="createForm" style="display: none;">
                <form id="travelReportForm">
                    <div class="form-group">
                        <label for="reportTitle">출장보고 제목</label>
                        <input type="text" id="reportTitle" name="title" required placeholder="출장보고서 제목을 입력하세요">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="destination">출장지</label>
                            <input type="text" id="destination" name="destination" required placeholder="출장지명을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label for="purpose">출장 목적</label>
                            <select id="purpose" name="purpose" required>
                                <option value="">선택하세요</option>
                                <option value="meeting">회의</option>
                                <option value="training">교육</option>
                                <option value="inspection">점검</option>
                                <option value="business">영업</option>
                                <option value="other">기타</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">출발일</label>
                            <input type="date" id="startDate" name="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">귀환일</label>
                            <input type="date" id="endDate" name="endDate" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="participants">동행자</label>
                        <input type="text" id="participants" name="participants" placeholder="동행자명을 입력하세요 (쉼표로 구분)">
                    </div>

                    <div class="form-group">
                        <label for="expenses">경비 내역</label>
                        <div class="expense-grid">
                            <div class="expense-item">
                                <label for="transportation">교통비</label>
                                <input type="number" id="transportation" name="transportation" placeholder="0" min="0">
                            </div>
                            <div class="expense-item">
                                <label for="accommodation">숙박비</label>
                                <input type="number" id="accommodation" name="accommodation" placeholder="0" min="0">
                            </div>
                            <div class="expense-item">
                                <label for="meals">식비</label>
                                <input type="number" id="meals" name="meals" placeholder="0" min="0">
                            </div>
                            <div class="expense-item">
                                <label for="other">기타</label>
                                <input type="number" id="other" name="other" placeholder="0" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="reportContent">출장 내용</label>
                        <textarea id="reportContent" name="content" rows="8" required placeholder="출장 중 수행한 업무 내용을 작성하세요..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="reportAttachments">첨부파일</label>
                        <input type="file" id="reportAttachments" name="attachments" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png">
                        <small>지원 형식: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="hideCreateForm()">취소</button>
                        <button type="submit" class="btn-primary">보고서 저장</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <h3>출장보고 목록</h3>
                <div class="filter-controls">
                    <select id="statusFilter" onchange="filterReports()">
                        <option value="">전체 상태</option>
                        <option value="draft">임시저장</option>
                        <option value="submitted">제출됨</option>
                        <option value="approved">승인됨</option>
                        <option value="rejected">반려됨</option>
                    </select>
                    <input type="month" id="monthFilter" onchange="filterReports()" placeholder="월별 필터">
                </div>
            </div>

            <div class="reports-list" id="reportsList">
                <div class="report-item">
                    <div class="report-header">
                        <h4>서울 고객사 방문 출장보고</h4>
                        <span class="report-status status-submitted">제출됨</span>
                    </div>
                    <div class="report-meta">
                        <span>출장지: 서울시 강남구</span>
                        <span>기간: 2024-01-15 ~ 2024-01-16</span>
                        <span>목적: 고객 미팅</span>
                    </div>
                    <div class="report-summary">
                        <span>총 경비: 150,000원</span>
                        <span>동행자: 김철수, 이영희</span>
                    </div>
                    <div class="report-actions">
                        <button class="btn-small btn-info" onclick="viewReport(1)">보기</button>
                        <button class="btn-small btn-secondary" onclick="downloadReport(1)">다운로드</button>
                    </div>
                </div>

                <div class="report-item">
                    <div class="report-header">
                        <h4>부산 공장 점검 출장보고</h4>
                        <span class="report-status status-draft">임시저장</span>
                    </div>
                    <div class="report-meta">
                        <span>출장지: 부산시 사상구</span>
                        <span>기간: 2024-01-20 ~ 2024-01-22</span>
                        <span>목적: 설비 점검</span>
                    </div>
                    <div class="report-summary">
                        <span>총 경비: 320,000원</span>
                        <span>동행자: 없음</span>
                    </div>
                    <div class="report-actions">
                        <button class="btn-small btn-primary" onclick="editReport(2)">수정</button>
                        <button class="btn-small btn-success" onclick="submitReport(2)">제출</button>
                        <button class="btn-small btn-danger" onclick="deleteReport(2)">삭제</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function handleLogout() {
            fetch('/logout', { method: 'GET' })
                .then(() => window.location.href = '/login')
                .catch(error => console.error('Logout error:', error));
        }

        function showCreateForm() {
            document.getElementById('createForm').style.display = 'block';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
        }

        function hideCreateForm() {
            document.getElementById('createForm').style.display = 'none';
            document.getElementById('travelReportForm').reset();
        }

        function filterReports() {
            const statusFilter = document.getElementById('statusFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            console.log('Filtering travel reports by status:', statusFilter, 'month:', monthFilter);
        }

        function editReport(id) {
            console.log('Editing travel report:', id);
            showCreateForm();
        }

        function submitReport(id) {
            console.log('Submitting travel report:', id);
        }

        function deleteReport(id) {
            if (confirm('정말로 이 출장보고를 삭제하시겠습니까?')) {
                console.log('Deleting travel report:', id);
            }
        }

        function viewReport(id) {
            console.log('Viewing travel report:', id);
        }

        function downloadReport(id) {
            console.log('Downloading travel report:', id);
        }

        document.getElementById('travelReportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Saving travel report...');
            hideCreateForm();
        });
    </script>
</body>
</html>
