<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/images/favicon.ico">
    <title>Doowon Portal - Admin Settings</title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/darkmode.css" />
    <link rel="stylesheet" type="text/css" href="css/table.css" />
    <style>
        .vehicle-type-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .vehicle-type-input {
            flex: 1;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .vehicle-type-config {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .field-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .field-item .field-mapping-input {
            flex: 1;
        }
    </style>
</head>

<body>
    <div class="admin-header">
        <h1>⚙️ Admin Settings</h1>
        <p>Codebeamer 필드 매핑 및 시스템 설정 관리</p>
    </div>

    <nav class="admin-nav">
        <div class="admin-nav-container">
            <div class="admin-nav-title">관리자 패널</div>
            <div class="admin-nav-actions">
                <span class="admin-username">관리자: <%= username %></span>
                <a href="/admin/logout" class="btn-admin btn-secondary">로그아웃</a>
            </div>
        </div>
    </nav>

    <div class="admin-section">
        <div class="codebeamer-info">
            <h4>🔗 Codebeamer 연결 정보</h4>
            <div class="info-item">
                <span class="info-label">서버 URL:</span>
                <span class="info-value"><%= serverUrl %></span>
            </div>
            <div class="info-item">
                <span class="info-label">연결 상태:</span>
                <span class="info-value" id="connectionStatus">확인 중...</span>
            </div>
        </div>

        <div class="mapping-summary">
            <h4>📊 필드 매핑 현황</h4>
            <div class="mapping-stats">
                <div class="stat-item">
                    <span class="status-indicator status-mapped"></span>
                    <span>매핑 완료: <strong id="mappedCount">0</strong>개</span>
                </div>
                <div class="stat-item">
                    <span class="status-indicator status-pending"></span>
                    <span>매핑 대기: <strong id="pendingCount">0</strong>개</span>
                </div>
                <div class="stat-item">
                    <span class="status-indicator status-unmapped"></span>
                    <span>매핑 필요: <strong id="unmappedCount">0</strong>개</span>
                </div>
            </div>
        </div>

        <!-- 주간보고관리 필드 매핑 -->
        <div class="section-card">
            <div class="section-header">
                <h3>📊 주간보고관리 필드 매핑</h3>
                <p>주간보고서의 각 필드를 Codebeamer의 해당 필드와 매핑합니다.</p>
            </div>
            <div class="section-content">
                <div class="field-mapping">
                    <div class="field-group">
                        <h4>기본 정보</h4>
                        <div class="field-item">
                            <span class="field-label">보고서 제목</span>
                            <input type="text" class="field-mapping-input" value="name" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">보고 주차</span>
                            <input type="text" class="field-mapping-input" value="custom_field_1">
                        </div>
                        <div class="field-item">
                            <span class="field-label">작성일</span>
                            <input type="text" class="field-mapping-input" value="submittedAt" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">사업부</span>
                            <input type="text" class="field-mapping-input" value="custom_field_2">
                        </div>
                    </div>
                    <div class="field-group">
                        <h4>보고 내용</h4>
                        <div class="field-item">
                            <span class="field-label">금주 주간보고</span>
                            <input type="text" class="field-mapping-input" value="custom_field_3">
                        </div>
                        <div class="field-item">
                            <span class="field-label">차주 주간보고</span>
                            <input type="text" class="field-mapping-input" value="custom_field_4">
                        </div>
                        <div class="field-item">
                            <span class="field-label">첨부파일</span>
                            <input type="text" class="field-mapping-input" value="attachments">
                        </div>
                        <div class="field-item">
                            <span class="field-label">상태</span>
                            <input type="text" class="field-mapping-input" value="status" readonly>
                        </div>
                    </div>
                </div>
                <div class="admin-button-container">
                    <button class="btn-admin btn-primary" onclick="saveMapping('weekly-reports')">매핑 저장</button>
                    <button class="btn-admin btn-warning" onclick="testMapping('weekly-reports')">매핑 테스트</button>
                </div>
            </div>
        </div>

        <!-- 출장보고관리 필드 매핑 -->
        <div class="section-card">
            <div class="section-header">
                <h3>✈️ 출장보고관리 필드 매핑</h3>
                <p>출장보고서의 각 필드를 Codebeamer의 해당 필드와 매핑합니다.</p>
            </div>
            <div class="section-content">
                <div class="field-mapping">
                    <div class="field-group">
                        <h4>기본 정보</h4>
                        <div class="field-item">
                            <span class="field-label">보고서 제목</span>
                            <input type="text" class="field-mapping-input" value="name" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">출장지</span>
                            <input type="text" class="field-mapping-input" value="custom_field_5">
                        </div>
                        <div class="field-item">
                            <span class="field-label">출장 목적</span>
                            <input type="text" class="field-mapping-input" value="custom_field_6">
                        </div>
                        <div class="field-item">
                            <span class="field-label">출발일</span>
                            <input type="text" class="field-mapping-input" value="custom_field_7">
                        </div>
                        <div class="field-item">
                            <span class="field-label">귀환일</span>
                            <input type="text" class="field-mapping-input" value="custom_field_8">
                        </div>
                    </div>
                    <div class="field-group">
                        <h4>상세 정보</h4>
                        <div class="field-item">
                            <span class="field-label">동행자</span>
                            <input type="text" class="field-mapping-input" value="custom_field_9">
                        </div>
                        <div class="field-item">
                            <span class="field-label">교통비</span>
                            <input type="text" class="field-mapping-input" value="custom_field_10">
                        </div>
                        <div class="field-item">
                            <span class="field-label">숙박비</span>
                            <input type="text" class="field-mapping-input" value="custom_field_11">
                        </div>
                        <div class="field-item">
                            <span class="field-label">식비</span>
                            <input type="text" class="field-mapping-input" value="custom_field_12">
                        </div>
                        <div class="field-item">
                            <span class="field-label">기타 경비</span>
                            <input type="text" class="field-mapping-input" value="custom_field_13">
                        </div>
                        <div class="field-item">
                            <span class="field-label">출장 내용</span>
                            <input type="text" class="field-mapping-input" value="description">
                        </div>
                    </div>
                </div>
                <div class="admin-button-container">
                    <button class="btn-admin btn-primary" onclick="saveMapping('travel-reports')">매핑 저장</button>
                    <button class="btn-admin btn-warning" onclick="testMapping('travel-reports')">매핑 테스트</button>
                </div>
            </div>
        </div>

        <!-- 하드웨어관리 필드 매핑 -->
        <div class="section-card">
            <div class="section-header">
                <h3>💻 하드웨어관리 필드 매핑</h3>
                <p>하드웨어 관리의 각 필드를 Codebeamer의 해당 필드와 매핑합니다.</p>
            </div>
            <div class="section-content">
                <div class="field-mapping">
                    <div class="field-group">
                        <h4>하드웨어 정보</h4>
                        <div class="field-item">
                            <span class="field-label">하드웨어명</span>
                            <input type="text" class="field-mapping-input" value="name" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">HW 버전</span>
                            <input type="text" class="field-mapping-input" value="custom_field_3" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">SW 버전</span>
                            <input type="text" class="field-mapping-input" value="custom_field_10002" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">차종</span>
                            <input type="text" class="field-mapping-input" value="custom_field_1000" readonly>
                            <button class="btn-admin btn-info btn-small" onclick="toggleVehicleTypeConfig()" id="vehicleTypeToggleBtn">
                                <span id="vehicleTypeToggleText">차종 설정 열기</span>
                            </button>
                        </div>
                        <div class="field-item">
                            <span class="field-label">변경사항</span>
                            <input type="text" class="field-mapping-input" value="custom_field_1001" readonly>
                        </div>
                    </div>
                    <div class="field-group">
                        <h4>추가 정보</h4>
                        <div class="field-item">
                            <span class="field-label">변경 사유</span>
                            <input type="text" class="field-mapping-input" value="custom_field_10005" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">Release 일자</span>
                            <input type="text" class="field-mapping-input" value="custom_field_10006" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">설명</span>
                            <input type="text" class="field-mapping-input" value="description" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">상태</span>
                            <input type="text" class="field-mapping-input" value="status" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">등록자</span>
                            <input type="text" class="field-mapping-input" value="submittedBy" readonly>
                        </div>
                    </div>
                </div>
                
                <!-- Collapsible Vehicle Type Configuration -->
                <div id="vehicleTypeConfig" class="vehicle-type-config" style="display: none;">
                    <div class="field-mapping">
                        <div class="field-group">
                            <h4>🚗 차종 옵션 관리</h4>
                            <p>하드웨어 관리에서 사용할 차종 옵션을 동적으로 관리합니다.</p>
                            <div id="vehicleTypeOptions">
                                <div class="vehicle-type-item">
                                    <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="SW">
                                    <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
                                </div>
                                <div class="vehicle-type-item">
                                    <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="OV1">
                                    <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
                                </div>
                                <div class="vehicle-type-item">
                                    <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="HE1i">
                                    <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
                                </div>
                                <div class="vehicle-type-item">
                                    <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="SX3">
                                    <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
                                </div>
                                <div class="vehicle-type-item">
                                    <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="NQ6">
                                    <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
                                </div>
                                <div class="vehicle-type-item">
                                    <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="LT2">
                                    <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
                                </div>
                            </div>
                            <button class="btn-admin btn-success" onclick="addVehicleType()">+ 차종 추가</button>
                        </div>
                    </div>
                    <div class="admin-button-container">
                        <button class="btn-admin btn-primary" onclick="saveVehicleTypes()">차종 설정 저장</button>
                        <button class="btn-admin btn-warning" onclick="loadVehicleTypes()">설정 불러오기</button>
                        <button class="btn-admin btn-danger" onclick="resetVehicleTypes()">기본값으로 초기화</button>
                    </div>
                </div>
                
                <div class="admin-button-container">
                    <button class="btn-admin btn-success" onclick="viewHardwareMapping()">매핑 확인</button>
                    <button class="btn-admin btn-warning" onclick="testMapping('hardware-management')">매핑 테스트</button>
                </div>
            </div>
        </div>

        <!-- 장비관리 필드 매핑 -->
        <div class="section-card">
            <div class="section-header">
                <h3>🔧 장비관리 필드 매핑</h3>
                <p>장비 관리의 각 필드를 Codebeamer의 해당 필드와 매핑합니다.</p>
            </div>
            <div class="section-content">
                <div class="field-mapping">
                    <div class="field-group">
                        <h4>장비 기본 정보</h4>
                        <div class="field-item">
                            <span class="field-label">장비명</span>
                            <input type="text" class="field-mapping-input" value="name" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">카테고리</span>
                            <input type="text" class="field-mapping-input" value="custom_field_14">
                        </div>
                        <div class="field-item">
                            <span class="field-label">제조사</span>
                            <input type="text" class="field-mapping-input" value="custom_field_15">
                        </div>
                        <div class="field-item">
                            <span class="field-label">모델명</span>
                            <input type="text" class="field-mapping-input" value="custom_field_16">
                        </div>
                        <div class="field-item">
                            <span class="field-label">시리얼 번호</span>
                            <input type="text" class="field-mapping-input" value="custom_field_17">
                        </div>
                    </div>
                    <div class="field-group">
                        <h4>장비 상세 정보</h4>
                        <div class="field-item">
                            <span class="field-label">구매일</span>
                            <input type="text" class="field-mapping-input" value="custom_field_18">
                        </div>
                        <div class="field-item">
                            <span class="field-label">보증만료일</span>
                            <input type="text" class="field-mapping-input" value="custom_field_19">
                        </div>
                        <div class="field-item">
                            <span class="field-label">설치위치</span>
                            <input type="text" class="field-mapping-input" value="custom_field_20">
                        </div>
                        <div class="field-item">
                            <span class="field-label">담당자</span>
                            <input type="text" class="field-mapping-input" value="custom_field_21">
                        </div>
                        <div class="field-item">
                            <span class="field-label">사양</span>
                            <input type="text" class="field-mapping-input" value="description">
                        </div>
                        <div class="field-item">
                            <span class="field-label">비고</span>
                            <input type="text" class="field-mapping-input" value="custom_field_22">
                        </div>
                    </div>
                </div>
                <div class="admin-button-container">
                    <button class="btn-admin btn-primary" onclick="saveMapping('equipment-management')">매핑 저장</button>
                    <button class="btn-admin btn-warning" onclick="testMapping('equipment-management')">매핑 테스트</button>
                </div>
            </div>
        </div>

        <!-- 외부교육관리 필드 매핑 -->
        <div class="section-card">
            <div class="section-header">
                <h3>🎓 외부교육관리 필드 매핑</h3>
                <p>외부 교육 관리의 각 필드를 Codebeamer의 해당 필드와 매핑합니다.</p>
            </div>
            <div class="section-content">
                <div class="field-mapping">
                    <div class="field-group">
                        <h4>교육 기본 정보</h4>
                        <div class="field-item">
                            <span class="field-label">교육명</span>
                            <input type="text" class="field-mapping-input" value="name" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">교육기관</span>
                            <input type="text" class="field-mapping-input" value="custom_field_23">
                        </div>
                        <div class="field-item">
                            <span class="field-label">교육유형</span>
                            <input type="text" class="field-mapping-input" value="custom_field_24">
                        </div>
                        <div class="field-item">
                            <span class="field-label">교육시작일</span>
                            <input type="text" class="field-mapping-input" value="custom_field_25">
                        </div>
                        <div class="field-item">
                            <span class="field-label">교육종료일</span>
                            <input type="text" class="field-mapping-input" value="custom_field_26">
                        </div>
                    </div>
                    <div class="field-group">
                        <h4>교육 상세 정보</h4>
                        <div class="field-item">
                            <span class="field-label">교육장소</span>
                            <input type="text" class="field-mapping-input" value="custom_field_27">
                        </div>
                        <div class="field-item">
                            <span class="field-label">참석자</span>
                            <input type="text" class="field-mapping-input" value="custom_field_28">
                        </div>
                        <div class="field-item">
                            <span class="field-label">수강료</span>
                            <input type="text" class="field-mapping-input" value="custom_field_29">
                        </div>
                        <div class="field-item">
                            <span class="field-label">숙박비</span>
                            <input type="text" class="field-mapping-input" value="custom_field_30">
                        </div>
                        <div class="field-item">
                            <span class="field-label">교통비</span>
                            <input type="text" class="field-mapping-input" value="custom_field_31">
                        </div>
                        <div class="field-item">
                            <span class="field-label">식비</span>
                            <input type="text" class="field-mapping-input" value="custom_field_32">
                        </div>
                        <div class="field-item">
                            <span class="field-label">교육내용</span>
                            <input type="text" class="field-mapping-input" value="description">
                        </div>
                        <div class="field-item">
                            <span class="field-label">기대효과</span>
                            <input type="text" class="field-mapping-input" value="custom_field_33">
                        </div>
                    </div>
                </div>
                <div class="admin-button-container">
                    <button class="btn-admin btn-primary" onclick="saveMapping('external-training')">매핑 저장</button>
                    <button class="btn-admin btn-warning" onclick="testMapping('external-training')">매핑 테스트</button>
                </div>
            </div>
        </div>

        <!-- 시스템 설정 -->
        <div class="section-card">
            <div class="section-header">
                <h3>⚙️ 시스템 설정</h3>
                <p>전체 시스템 설정 및 Codebeamer 연동 설정을 관리합니다.</p>
            </div>
            <div class="section-content">
                <div class="field-mapping">
                    <div class="field-group">
                        <h4>Codebeamer 설정</h4>
                        <div class="field-item">
                            <span class="field-label">API URL</span>
                            <input type="text" class="field-mapping-input" value="<%= serverUrl %>" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">프로젝트 ID</span>
                            <input type="text" class="field-mapping-input" value="project_id">
                        </div>
                        <div class="field-item">
                            <span class="field-label">트래커 ID (주간보고)</span>
                            <input type="text" class="field-mapping-input" value="tracker_weekly">
                        </div>
                        <div class="field-item">
                            <span class="field-label">트래커 ID (출장보고)</span>
                            <input type="text" class="field-mapping-input" value="tracker_travel">
                        </div>
                        <div class="field-item">
                            <span class="field-label">트래커 ID (하드웨어)</span>
                            <input type="text" class="field-mapping-input" value="19601" readonly>
                        </div>
                        <div class="field-item">
                            <span class="field-label">트래커 ID (장비)</span>
                            <input type="text" class="field-mapping-input" value="tracker_equipment">
                        </div>
                        <div class="field-item">
                            <span class="field-label">트래커 ID (교육)</span>
                            <input type="text" class="field-mapping-input" value="tracker_training">
                        </div>
                    </div>
                    <div class="field-group">
                        <h4>시스템 설정</h4>
                        <div class="field-item">
                            <span class="field-label">자동 동기화</span>
                            <input type="checkbox" class="admin-checkbox-auto">
                        </div>
                        <div class="field-item">
                            <span class="field-label">동기화 주기 (분)</span>
                            <input type="number" class="field-mapping-input" value="30">
                        </div>
                        <div class="field-item">
                            <span class="field-label">로그 레벨</span>
                            <select class="field-mapping-input">
                                <option value="debug">Debug</option>
                                <option value="info" selected>Info</option>
                                <option value="warn">Warning</option>
                                <option value="error">Error</option>
                            </select>
                        </div>
                        <div class="field-item">
                            <span class="field-label">백업 활성화</span>
                            <input type="checkbox" checked class="admin-checkbox-auto">
                        </div>
                        <div class="field-item">
                            <span class="field-label">백업 주기 (일)</span>
                            <input type="number" class="field-mapping-input" value="7">
                        </div>
                    </div>
                </div>
                <div class="admin-button-container">
                    <button class="btn-admin btn-primary" onclick="saveSystemSettings()">설정 저장</button>
                    <button class="btn-admin btn-success" onclick="testConnection()">연결 테스트</button>
                    <button class="btn-admin btn-warning" onclick="syncAllData()">전체 동기화</button>
                    <button class="btn-admin btn-danger" onclick="resetSettings()">설정 초기화</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check Codebeamer connection status
        async function checkConnection() {
            try {
                const response = await fetch('/api/debug/ping');
                const data = await response.json();
                const statusElement = document.getElementById('connectionStatus');
                
                if (data.success) {
                    statusElement.textContent = '연결됨';
                    statusElement.style.color = '#28a745';
                } else {
                    statusElement.textContent = '연결 실패';
                    statusElement.style.color = '#dc3545';
                }
            } catch (error) {
                document.getElementById('connectionStatus').textContent = '연결 실패';
                document.getElementById('connectionStatus').style.color = '#dc3545';
            }
        }

        // Update mapping statistics
        function updateMappingStats() {
            const mappedCount = document.querySelectorAll('.field-mapping-input[readonly]').length;
            const totalFields = document.querySelectorAll('.field-mapping-input').length;
            const pendingCount = Math.floor(totalFields * 0.3);
            const unmappedCount = totalFields - mappedCount - pendingCount;
            
            document.getElementById('mappedCount').textContent = mappedCount;
            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('unmappedCount').textContent = unmappedCount;
        }

        // Save field mapping
        function saveMapping(section) {
            const inputs = document.querySelectorAll(`[data-section="${section}"] .field-mapping-input`);
            const mapping = {};
            
            inputs.forEach(input => {
                const label = input.previousElementSibling.textContent;
                mapping[label] = input.value;
            });
            
            console.log(`Saving mapping for ${section}:`, mapping);
            alert(`${section} 필드 매핑이 저장되었습니다.`);
        }

        // Test field mapping
        function testMapping(section) {
            console.log(`Testing mapping for ${section}`);
            alert(`${section} 필드 매핑 테스트를 시작합니다.`);
        }

        // View hardware mapping (read-only)
        function viewHardwareMapping() {
            alert('하드웨어관리는 이미 Codebeamer와 연동되어 있습니다.\n현재 매핑된 필드들을 확인할 수 있습니다.');
        }

        // Save system settings
        function saveSystemSettings() {
            console.log('Saving system settings...');
            alert('시스템 설정이 저장되었습니다.');
        }

        // Test connection
        function testConnection() {
            checkConnection();
        }

        // Sync all data
        function syncAllData() {
            console.log('Syncing all data...');
            alert('전체 데이터 동기화를 시작합니다.');
        }

        // Reset settings
        function resetSettings() {
            if (confirm('정말로 모든 설정을 초기화하시겠습니까?')) {
                console.log('Resetting settings...');
                alert('설정이 초기화되었습니다.');
            }
        }

        // Toggle Vehicle Type Configuration
        function toggleVehicleTypeConfig() {
            const configDiv = document.getElementById('vehicleTypeConfig');
            const toggleBtn = document.getElementById('vehicleTypeToggleBtn');
            const toggleText = document.getElementById('vehicleTypeToggleText');
            
            if (configDiv.style.display === 'none') {
                configDiv.style.display = 'block';
                toggleText.textContent = '차종 설정 닫기';
                toggleBtn.classList.add('btn-warning');
                toggleBtn.classList.remove('btn-info');
            } else {
                configDiv.style.display = 'none';
                toggleText.textContent = '차종 설정 열기';
                toggleBtn.classList.add('btn-info');
                toggleBtn.classList.remove('btn-warning');
            }
        }

        // Vehicle Type Management Functions
        function addVehicleType() {
            const container = document.getElementById('vehicleTypeOptions');
            const newItem = document.createElement('div');
            newItem.className = 'vehicle-type-item';
            newItem.innerHTML = `
                <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="">
                <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
            `;
            container.appendChild(newItem);
        }

        function removeVehicleType(button) {
            const container = document.getElementById('vehicleTypeOptions');
            if (container.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('최소 하나의 차종은 유지해야 합니다.');
            }
        }

        function getVehicleTypes() {
            const inputs = document.querySelectorAll('.vehicle-type-input');
            const vehicleTypes = [];
            inputs.forEach(input => {
                if (input.value.trim()) {
                    vehicleTypes.push(input.value.trim());
                }
            });
            return vehicleTypes;
        }

        function setVehicleTypes(vehicleTypes) {
            const container = document.getElementById('vehicleTypeOptions');
            container.innerHTML = '';
            
            vehicleTypes.forEach(type => {
                const newItem = document.createElement('div');
                newItem.className = 'vehicle-type-item';
                newItem.innerHTML = `
                    <input type="text" class="field-mapping-input vehicle-type-input" placeholder="차종명 입력" value="${type}">
                    <button class="btn-admin btn-danger btn-small" onclick="removeVehicleType(this)">삭제</button>
                `;
                container.appendChild(newItem);
            });
        }

        async function saveVehicleTypes() {
            const vehicleTypes = getVehicleTypes();
            
            if (vehicleTypes.length === 0) {
                alert('최소 하나의 차종을 입력해주세요.');
                return;
            }

            try {
                const response = await fetch('/api/admin/vehicle-types', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ vehicleTypes })
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('차종 설정이 저장되었습니다.');
                } else {
                    alert('차종 설정 저장에 실패했습니다: ' + data.error);
                }
            } catch (error) {
                console.error('Error saving vehicle types:', error);
                alert('차종 설정 저장 중 오류가 발생했습니다.');
            }
        }

        async function loadVehicleTypes() {
            try {
                const response = await fetch('/api/admin/vehicle-types');
                const data = await response.json();
                
                if (data.success) {
                    setVehicleTypes(data.vehicleTypes);
                    alert('차종 설정을 불러왔습니다.');
                } else {
                    alert('차종 설정 불러오기에 실패했습니다: ' + data.error);
                }
            } catch (error) {
                console.error('Error loading vehicle types:', error);
                alert('차종 설정 불러오기 중 오류가 발생했습니다.');
            }
        }

        function resetVehicleTypes() {
            if (confirm('기본 차종 설정으로 초기화하시겠습니까?')) {
                const defaultTypes = ['SW', 'OV1', 'HE1i', 'SX3', 'NQ6', 'LT2'];
                setVehicleTypes(defaultTypes);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkConnection();
            updateMappingStats();
            loadVehicleTypes();
        });
    </script>
</body>
</html>
